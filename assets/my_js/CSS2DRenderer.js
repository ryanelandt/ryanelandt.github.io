import{Matrix4,Object3D,Vector2,Vector3}from"./three.module.min.js";class CSS2DObject extends Object3D{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Vector2(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const _vector=new Vector3,_viewMatrix=new Matrix4,_viewProjectionMatrix=new Matrix4,_a=new Vector3,_b=new Vector3;class CSS2DRenderer{constructor(e={}){function t(e,n,o){if(e.isCSS2DObject){_vector.setFromMatrixPosition(e.matrixWorld),_vector.applyMatrix4(_viewProjectionMatrix);const t=!0===e.visible&&_vector.z>=-1&&_vector.z<=1&&!0===e.layers.test(o.layers);if(e.element.style.display=!0===t?"":"none",!0===t){e.onBeforeRender(i,n,o);const t=e.element;t.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(_vector.x*a+a)+"px,"+(-_vector.y*l+l)+"px)",t.parentNode!==m&&m.appendChild(t),e.onAfterRender(i,n,o)}const s={distanceToCameraSquared:r(o,e)};d.objects.set(e,s)}for(let r=0,i=e.children.length;r<i;r++)t(e.children[r],n,o)}function r(e,t){return _a.setFromMatrixPosition(e.matrixWorld),_b.setFromMatrixPosition(t.matrixWorld),_a.distanceToSquared(_b)}function n(e){const t=[];return e.traverse(function(e){e.isCSS2DObject&&t.push(e)}),t}function o(e){const t=n(e).sort(function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return d.objects.get(e).distanceToCameraSquared-d.objects.get(t).distanceToCameraSquared}),r=t.length;for(let e=0,n=t.length;e<n;e++)t[e].element.style.zIndex=r-e}const i=this;let s,c,a,l;const d={objects:new WeakMap},m=e.element!==undefined?e.element:document.createElement("div");m.style.overflow="hidden",this.domElement=m,this.getSize=function(){return{width:s,height:c}},this.render=function(e,r){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===r.parent&&!0===r.matrixWorldAutoUpdate&&r.updateMatrixWorld(),_viewMatrix.copy(r.matrixWorldInverse),_viewProjectionMatrix.multiplyMatrices(r.projectionMatrix,_viewMatrix),t(e,e,r),o(e)},this.setSize=function(e,t){a=(s=e)/2,l=(c=t)/2,m.style.width=e+"px",m.style.height=t+"px"}}}export{CSS2DObject,CSS2DRenderer};